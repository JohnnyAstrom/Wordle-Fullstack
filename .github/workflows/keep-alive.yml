name: Keep Atlas Alive

on:
  schedule:
    - cron: "0 */129 * * *"  # var 10:e timme (UTC)
  workflow_dispatch:        # kan k√∂ras manuellt

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Install MongoDB driver
        run: npm install mongodb
      - name: Ping MongoDB Atlas
        run: |
          node - <<'EOF'
          import { MongoClient } from "mongodb";
          const uri = process.env.MONGODB_URI;
          const client = new MongoClient(uri, { serverSelectionTimeoutMS: 10000 });
          (async () => {
            try {
              await client.connect();
              await client.db("admin").command({ ping: 1 });
              console.log("Ping OK");
            } catch (err) {
              console.error("Ping failed:", err);
              process.exit(1);
            } finally {
              await client.close();
            }
          })();
          EOF
        env:
          MONGODB_URI: ${{ secrets.MONGODB_URI }}